{
	"$schema": "https://vega.github.io/schema/vega/v3.0.json",
	"width": 500,
	"height": 500,
	"data": [{
		"name": "table",
		"url":"https://api.myjson.com/bins/p214t",
		"transform": [{
			"type": "stack",
			"field": "arcValue",
			"groupby": [{
				"signal": "groupByField"
			}]
		}]
	}, {
		"name": "ConcentricCircles",
		"values": [{"value":5553,"label":"5.6K"},{"value":11106,"label":"11.1K"},{"value":16659,"label":"16.7K"},{"value":22212,"label":"22.2K"},{"value":27765,"label":"27.8K"}]
	}, {
		"name": "arcLabels",
		"values": ["RICOH KK","FUJI XEROX CO LTD","MICROSOFT CORP","SEIKO EPSON CORP","RICOH CO LTD","[unspecified]","BROTHER IND LTD","SHARP KK","KONICA MINOLTA BUSINESS TECH","KYOCERA MITA CORP"]
	}],
	"signals": [{
		"name": "groupByField",
		"value": "groupId1"
	}, {
		"name": "mouseHoverField",
		"value": "legendHoverField"
	}, {
		"name": "stackByField",
		"value": "caid"
	}, {
		"name": "arcMaxValue",
		"value": 27765
		
	}, {
		"name": "stacksCount",
		"value": 3
	}, {
		"name": "splitAngle",
		"value": 0.6283185307179586
	}, {
		"name": "arcColorField",
		"value": "pa"
	}, {
		"name": "width",
		"value": ""
	}, {
		"name": "height",
		"value": ""
	}, {
		"name": "position",
		"value": "",
		"on": [{
			"events": "window:click,click!",
			"update": "event"
		}, {
			"events": "mousemove",
			"update": "''"
		}]
	}, {
		"name": "mouseClickArc",
		"value": "",
		"on": [{
			"events": "window:click,click!",
			"update": "datum"
		}, {
			"events": "mousemove",
			"update": "''"
		}]
	}, {
		"name": "mouseHoverArc",
		"value": "",
		"on": [{
			"events": "arc:mouseover",
			"update": "datum[mouseHoverField]"
		}, {
			"events": "arc:mouseout",
			"update": "''"
		}]
	}],
	"scales": [{
		"name": "logged",
		"type": "log",
		"domain": [1,{"signal": "arcMaxValue"}],
		"range": [{
			"signal": "width*0.03"
		}, {
			"signal": "width*0.50"
		}]
	},{
		"name": "r",
		"type": "linear",
		"domain": {
			"data": "table",
			"field": "y1"
		},
		"range": [{
			"signal": "width*0.03"
		}, {
			"signal": "width*0.50"
		}]
	}, {
		"name": "arcColors",
		"type": "ordinal",
		"domain": {
			"data": "arcLabels",
			"field": "data"
		},
		"range": ["#e148cf", "#f46d7a", "#ffa473", "#487e75", "#56cb9d", "#5eb4f6", "#646db1", "#9f5dbc", "#b96752", "#fee26d", "#f44336", "#E91E63", "#8BC34A", "#CDDC39", "#FFC107", "#FF5722", "#795548", "#607D8B", "#817717", "#880E4F"]
	}],
	"marks": [{
		"name": "mark",
		"type": "arc",
		"from": {
			"data": "table"
		},
		"encode": {
			"enter": {
				"x": {"signal": "width / 2"},
				"y": {"signal": "height / 2"}
			},
			"update": {
				"startAngle": {
					"signal": "(datum[groupByField] - 1)*(splitAngle)"
				},
				"endAngle": {
					"signal": "datum[groupByField]*(splitAngle)"
				},
				"innerRadius": {
					"scale": "r",
					"field": "y0"
				},
				"outerRadius": {
					"scale": "r",
					"field": "y1"
				},
				"fill": [{
					"test": "datum.arcColor",
					"signal": "datum.arcColor"
				}, {
					"scale": "arcColors",
					"signal": "datum[arcColorField]"
				}],
				"fillOpacity": {
					"signal": "(parseInt(datum[stackByField]) + 1)*(1/stacksCount)"
				},
				"opacity": [{
					"test": "(!mouseHoverArc || mouseHoverArc == datum[mouseHoverField])",
					"value": 1
				}, {
					"value": 0.4
				}],
				"cursor": {
					"value": "pointer"
				}
			}
		}
	}, {
		"type": "text",
		"from": {
			"data": "table"
		},
		"encode": {
			"enter": {},
			"update": {
			"x": {"signal": "width / 2"},
				"y": {"signal": "height / 2"},
				"radius": {
					"scale": "r",
					"signal": "(datum.y1+datum.y0)/2",
					"offset": 4
				},
				"theta": {
					"signal": "((datum[groupByField] - 1)*(splitAngle) + datum[groupByField]*(splitAngle))/2"
				},
				"fill": {
					"value": "black"
				},
				"align": {
					"value": "center"
				},
				"baseline": {
					"value": "bottom"
				},
				"fontStyle": {
					"value": "italic"
				},
				"fontSize": {
					"value": "12"
				},
				"font": {
					"value": "Source Sans Pro"
				},
				"text": {
					"signal": "(datum.value != 0)? datum.count : ''\n"
				},
				"opacity": [{
					"test": "(!mouseHoverArc || mouseHoverArc == datum[mouseHoverField])",
					"value": 1
				}, {
					"value": 0.4
				}]
			}
		}
	}, {
		"type": "arc",
		"from": {
			"data": "ConcentricCircles"
		},
		"encode": {
			"enter": {
						"x": {"signal": "width / 2"},
				"y": {"signal": "height / 2"},
				"stroke": {
					"value": "lightgray"
				},
				"fillOpacity": {
					"value": 0
				}
			},
			"update": {
				"startAngle": {
					"value": 0
				},
				"endAngle": {
					"signal": "2*PI"
				},
				"innerRadius": {
					"signal": "width*0.03"
				},
				"outerRadius": {
					"scale": "r",
					"field": "value"
				}
			}
		}
	}, {
		"type": "text",
		"from": {
			"data": "ConcentricCircles"
		},
		"encode": {
			"update": {
					"x": {"signal": "width / 2"},
				"y": {"signal": "height / 2"},
				"radius": {
					"scale": "r",
					"field": "value"
				},
				"theta": {
					"signal": "PI/2"
				},
				"fill": {
					"value": "black"
				},
				"align": {
					"value": "left"
				},
				"baseline": {
					"value": "top"
				},
				"text": {
					"field": "label"
				},
				"fontWeight": {
					"value": "bold"
				},
				"fontSize": {
					"value": 13
				},
				"font": {
					"value": "Source Sans Pro"
				}
			}
		}
	}, {
		"type": "arc",
		"from": {
			"data": "table"
		},
		"encode": {
			"enter": {
					"x": {"signal": "width / 2"},
				"y": {"signal": "height / 2"},
				"stroke": {
					"value": "#fff"
				}
			},
			"update": {
				"innerRadius": {
					"signal": "width*0.03"
				},
				"outerRadius": {
					"scale": "r",
					"signal": "arcMaxValue"
				},
				"startAngle": {
					"data": "table",
					"signal": "(datum[groupByField] - 1)*(splitAngle)"
				},
				"endAngle": {
					"data": "table",
					"signal": "(datum[groupByField])*(splitAngle)"
				},
				"stroke": {
					"value": "lightgrey"
				},
				"opacity": [{
					"test": "(!mouseHoverArc || mouseHoverArc == datum[mouseHoverField])",
					"value": 1
				}, {
					"value": 0.4
				}]
			}
		}
	}]
}
